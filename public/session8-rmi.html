<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multicast UDP & Java RMI</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald">
  <link rel="stylesheet" href="/style.main.min.b8048638da11b2704c9ac4157cecae3c80b86dacaa16790b14b3a9f17eade743.css">
</head>
<body>
<nav class="topnav">
  <ul>
    <li><a href="/index.html">Trang chủ</a></li>
    <li><a href="/java-installation.html">Giới thiệu & Cài đặt Java</a></li>
    <li><a href="/session2-foundation.html">Kiến thức nền tảng</a></li>
    <li><a href="/session3-io.html">Quản lý luồng nhập/xuất</a></li>
    <li><a href="/session4-network-address.html">Quản lý địa chỉ mạng</a></li>
    <li><a href="/session5-tcp.html">Lập trình Sockets TCP</a></li>
    <li><a href="/session6-udp.html">Lập trình Socket UDP</a></li>
    <li><a href="/session7-threading.html">Đa tuyến & Xử lý đồng thời</a></li>
    <li><a href="/session8-rmi.html">Multicast UDP & Java RMI</a></li>
    <li><a href="/appendix-courses.html">Khóa học bổ trợ</a></li>
  </ul>
</nav>
<style>
.topnav {
  background-color: #222;
  overflow: hidden;
  text-align: center;
  margin-bottom: 20px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.topnav ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
  display: inline-block;
}
.topnav li {
  display: inline;
}
.topnav a {
  display: inline-block;
  color: white;
  text-align: center;
  padding: 14px 20px;
  text-decoration: none;
  font-family: 'Roboto', sans-serif;
}
.topnav a:hover {
  background-color: #575757;
  color: #fff;
}
.topnav a.active {
  background-color: #0078d7;
  color: white;
  border-radius: 3px;
}
</style>
<!-- Code font-size control toolbar -->
<div id="code-size-toolbar" style="position:fixed;right:18px;bottom:18px;background:rgba(0,0,0,0.6);color:#fff;padding:8px;border-radius:8px;z-index:9999;display:flex;gap:6px;align-items:center;font-family:Arial,Helvetica,sans-serif;">
  <button id="code-decrease" title="Giảm cỡ chữ" style="background:transparent;border:1px solid rgba(255,255,255,0.2);color:#fff;padding:6px 8px;border-radius:4px;cursor:pointer;">A-</button>
  <button id="code-reset" title="Reset" style="background:transparent;border:1px solid rgba(255,255,255,0.2);color:#fff;padding:6px 8px;border-radius:4px;cursor:pointer;">A</button>
  <button id="code-increase" title="Tăng cỡ chữ" style="background:transparent;border:1px solid rgba(255,255,255,0.2);color:#fff;padding:6px 8px;border-radius:4px;cursor:pointer;">A+</button>
</div>

<script>
  (function(){
    const root = document.documentElement;
    const key = 'codeFontSizeRem';
    const min = 0.6, max = 2.4, step = 0.1;
    function getSize(){ return parseFloat(localStorage.getItem(key)) || 1.0; }
    function setSize(v){ v = Math.min(max, Math.max(min, Math.round(v*10)/10)); localStorage.setItem(key, v); root.style.setProperty('--code-font-size', v + 'rem'); }
    // init
    setSize(getSize());
    document.getElementById('code-decrease').addEventListener('click', ()=> setSize(getSize()-step));
    document.getElementById('code-increase').addEventListener('click', ()=> setSize(getSize()+step));
    document.getElementById('code-reset').addEventListener('click', ()=> setSize(1.0));
  })();
</script>
<style>
  :root{
    --max-width: 1000px;
    --bg: #ddd;
    --card: #ffffff;
    --muted: #666;
    --accent: #e3bfb8;
    --radius: 12px;
    --shadow: 0 10px 30px rgba(102,102,102,0.12);
    --base-font: 18px;
  }

  body{ background: var(--bg); font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; color:#0b1220; font-size:var(--base-font); line-height:1.6; }

  .lesson-content{ max-width:var(--max-width); margin:28px auto; padding:28px; background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); }

  .lesson-content h1{ font-family: 'Oswald', 'Segoe UI', sans-serif; font-size:3rem; margin-bottom:10px; color:var(--accent); }
  .lesson-content h2{ font-size:2rem; margin-top:22px; color:#0b2a44; }

  .lesson-content ul{ margin-left:1.05rem; }

  .topnav a{ padding:16px 22px; font-size:1rem; }

  .lesson-content img{ display:block; width:100%; border-radius:8px; border:1px solid rgba(11,18,32,0.04); box-shadow:0 4px 12px rgba(9,18,28,0.04); margin-bottom:18px; }

  :root{ --code-font-size: 1rem; }
  pre{ background:#0b1220; color:#e6eef8; padding:20px; border-radius:10px; overflow:auto; font-family: 'Courier New', monospace; font-size:calc(var(--code-font-size) * 1.1); box-shadow:0 8px 24px rgba(2,6,23,0.25); }
  code{ background:rgba(2,6,23,0.06); padding:4px 8px; border-radius:6px; font-family: 'Courier New', monospace; font-size:var(--code-font-size); }

  .callout{ background: rgba(227,191,184,0.08); border-left:4px solid var(--accent); padding:12px 16px; border-radius:8px; margin-bottom:18px; }
  .callout p{ margin:0; font-size:1.15rem; color:#0b1220; }

  @media (max-width:640px){
    :root{ --base-font:18px; }
    .topnav ul{ display:block; }
    .topnav li{ display:block; }
    .topnav a{ display:block; padding:12px; }
    .lesson-content{ margin:14px; padding:18px; border-radius:10px; }
    .lesson-content h1{ font-size:2.2rem; }
  }
</style>
<style>
  .lesson-content b, .lesson-content strong { font-family: 'Oswald','Segoe UI',sans-serif; font-weight:700; color:#0b2a44; }
</style>

<div class="lesson-content">
  <h1>Multicast UDP & Java RMI</h1>

  <h2>Mục tiêu bài học</h2>
  <ul>
    <li>Hiểu multicast: nhóm Class D, tham gia/rời nhóm, TTL, lựa chọn interface, loopback.</li>
    <li>Thực hành gửi/nhận multicast với <code>MulticastSocket</code>; xây dựng kênh chat/announcements.</li>
    <li>Nắm Java RMI: interface từ xa, triển khai, đăng ký vào <code>Registry</code>, client lookup và gọi method.</li>
    <li>Nhận diện các hạn chế thực tế: firewall, router chặn multicast, cấu hình hostname khi RMI qua mạng.</li>
  </ul>

  <h2>1. Lý thuyết Multicast</h2>
  <ul>
    <li><b>Phạm vi địa chỉ</b>: Class D 224.0.0.0 – 239.255.255.255. Một số dải đặc biệt: 224.0.0.x (link-local control), 239.0.0.0/8 (administrative-scoped).</li>
    <li><b>TTL (Time To Live)</b>: số hop tối đa. TTL nhỏ (1) giữ gói trong nội bộ LAN.</li>
    <li><b>Tham gia nhóm</b>: dùng <code>joinGroup</code> để nhận gói gửi tới nhóm; rời nhóm bằng <code>leaveGroup</code>.</li>
    <li><b>Chọn interface</b>: máy đa NIC phải chọn <code>NetworkInterface</code> phù hợp khi join/send.</li>
    <li><b>IPv4 vs IPv6</b>: multicast tồn tại ở cả IPv6 (ff00::/8). Ví dụ dưới dùng IPv4 cho đơn giản.</li>
    <li><b>Giới hạn thực tế</b>: nhiều mạng/VM/OS tắt hoặc lọc multicast; cần kiểm tra cấu hình và firewall.</li>
  </ul>

  <div class="callout"><p>Ghi nhớ: Multicast là message-oriented giống UDP nhưng gửi tới nhiều người đăng ký cùng nhóm. Hãy đặt TTL hợp lý và chọn đúng interface.</p></div>

  <h2>2. Ví dụ — Multicast cơ bản: Sender và Receiver</h2>

  <p><b>Mã sender (Sender.java)</b></p>
  <pre><code class="language-java">/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 */
package com.mycompany.sender;

import java.io.IOException;
import java.net.DatagramPacket;
import java.net.InetAddress;
import java.net.MulticastSocket;

/**
 * @author PC
 */
public class Sender {
  public static void main(String[] args) {
    try {
      InetAddress multicastGroup = InetAddress.getByName("224.0.0.1"); // Multicast IP address
      int port = 6868; // Multicast port number
      MulticastSocket socket = new MulticastSocket();
      // socket.setInterface(InetAddress.getByName("10.100.3.154"));

      String message = "Chúc mừng. Bạn đã nhận được món quà là 2 điểm cộng!";
      byte[] buffer = message.getBytes();
      DatagramPacket packet = new DatagramPacket(buffer, buffer.length, multicastGroup, port);
      socket.send(packet);
      socket.close();
    } catch (IOException e) {
      e.printStackTrace();
    }
  }
}
</code></pre>

  <p><b>Mã receiver (Receivers.java)</b></p>
  <pre><code class="language-java">/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */
package com.mycompany.sender;

import java.io.IOException;
import java.net.DatagramPacket;
import java.net.InetAddress;
import java.net.MulticastSocket;

/**
 * @author PC
 */
public class Receivers {
  public static void main(String[] args) {
    try {
      InetAddress multicastGroup = InetAddress.getByName("224.0.0.1");
      int port = 6868; // Multicast port number

      MulticastSocket socket = new MulticastSocket(port);
      socket.joinGroup(multicastGroup);

      byte[] buffer = new byte[1024];
      DatagramPacket packet = new DatagramPacket(buffer, buffer.length);
      while (true) {
        socket.receive(packet);
        String message = new String(packet.getData(), 0, packet.getLength());
        System.out.println("Received: " + message);
      }
    } catch (IOException e) {
      e.printStackTrace();
    }
  }
}
</code></pre>

  <h3>Giải thích chi tiết</h3>
  <ul>
    <li>Receiver tham gia nhóm <code>224.0.0.1</code> trên cổng <code>6868</code> và in ra thông điệp multicast nhận được.</li>
    <li>Sender gửi một gói UDP tới địa chỉ nhóm/cổng; mọi receiver đã join cùng nhóm sẽ nhận được.</li>
    <li>Tùy mạng, multicast có thể bị chặn bởi thiết bị mạng hoặc firewall; cần kiểm tra cấu hình và có thể chọn interface cụ thể.</li>
  </ul>

  
  <h2>3. Giới thiệu và ví dụ đầy đủ Java RMI</h2>
  <p>RMI cho phép gọi phương thức của đối tượng từ xa như gọi cục bộ. Thành phần chính:</p>
  <ul>
    <li><b>Remote interface</b>: extends <code>java.rmi.Remote</code>; mọi method ném <code>RemoteException</code>.</li>
    <li><b>Implementation</b>: extends <code>UnicastRemoteObject</code> và implements interface từ xa.</li>
    <li><b>Registry</b>: nơi đăng ký (bind/rebind) và tra cứu (lookup) đối tượng từ xa.</li>
  </ul>

  <pre><code class="language-java">// TimeService.java (Remote interface)
import java.rmi.Remote;
import java.rmi.RemoteException;

public interface TimeService extends Remote {
  String now() throws RemoteException;
}

// TimeServiceImpl.java (Server-side implementation)
import java.rmi.RemoteException;
import java.rmi.server.UnicastRemoteObject;
import java.time.Instant;

public class TimeServiceImpl extends UnicastRemoteObject implements TimeService {
  public TimeServiceImpl() throws RemoteException { super(); }
  public String now() throws RemoteException { return Instant.now().toString(); }
}

// RMIServer.java
import java.rmi.Naming;
import java.rmi.registry.LocateRegistry;

public class RMIServer {
  public static void main(String[] args) throws Exception {
    // Tạo registry trên cổng 1099 nếu chưa có
    LocateRegistry.createRegistry(1099);
    // Khi chạy trên máy có nhiều IP và client ở máy khác, đặt hostname:
    // System.setProperty("java.rmi.server.hostname", "<ip_public>");

    TimeService svc = new TimeServiceImpl();
    Naming.rebind("rmi://localhost:1099/time", svc);
    System.out.println("RMI Server sẵn sàng @ rmi://localhost:1099/time");
  }
}

// RMIClient.java
import java.rmi.Naming;

public class RMIClient {
  public static void main(String[] args) throws Exception {
    String url = args.length > 0 ? args[0] : "rmi://localhost:1099/time";
    TimeService svc = (TimeService) Naming.lookup(url);
    System.out.println("Remote now(): " + svc.now());
  }
}
  </code></pre>

  <h3>Kết quả khi chạy server</h3>
  <pre><code>
RMI Server sẵn sàng @ rmi://localhost:1099/time
  </code></pre>

  <h3>Kết quả khi chạy client</h3>
  <pre><code>
Remote now(): 2023-10-18T10:30:45.123Z
  </code></pre>

  <h3>Giải thích chi tiết</h3>
  <ul>
    <li>Từ Java hiện đại, không cần chạy <code>rmic</code>; stub được sinh động (dynamic proxies).</li>
    <li>Có thể tạo <code>Registry</code> từ code bằng <code>LocateRegistry.createRegistry</code> thay vì chạy tiến trình riêng.</li>
    <li>Nếu client không kết n��i được từ máy khác, cần đặt <code>java.rmi.server.hostname</code> trỏ tới IP/hostname mà client truy cập được, và mở firewall cho cổng 1099.</li>
  </ul>

  <h2>4. Lưu ý và thực hành tốt</h2>
  <ul>
    <li>Multicast: chọn TTL phù hợp; chọn đúng <code>NetworkInterface</code> khi máy có nhiều NIC; kiểm tra chính sách mạng.</li>
    <li>Multicast trên máy ảo/docker có thể bị chặn; cần cấu hình bridge/route hoặc dùng unicast/broadcast thay thế.</li>
    <li>RMI: log rõ lỗi <code>RemoteException</code>; quản lý vòng đời đối tượng, và xem xét bảo mật khi mở registry qua mạng.</li>
    <li>Định danh dịch vụ RMI: dùng tên có tiền tố, ví dụ <code>rmi://host:1099/app/time</code> để tránh va chạm.</li>
  </ul>

  <h2>Tổng kết</h2>
  <p>Bài học giới thiệu truyền thông nhóm với multicast và cơ chế RPC hướng đối tượng bằng Java RMI. Bạn đã có các ví dụ Sender/Receiver multicast cơ bản và discovery, cùng dịch vụ RMI tối giản để gọi phương thức từ xa.</p>
</div>

<style>
  .pager{ max-width:var(--max-width); margin:10px auto 40px; padding:0 28px; display:flex; justify-content:space-between; align-items:center; }
  .pager a{ display:inline-block; background:#0078d7; color:#fff; padding:12px 18px; border-radius:8px; text-decoration:none; font-weight:600; box-shadow:0 4px 10px rgba(0,0,0,0.08); transition:background .2s ease, transform .1s ease; }
  .pager a:hover{ background:#005a9e; transform:translateY(-1px); }
  .pager a.disabled{ background:#b9c5d1; pointer-events:none; cursor:default; }
</style>
<div class="pager">
  <a class="prev" href="/session7-threading.html">← Trang trước</a>
  <a class="next" href="/appendix-courses.html">Trang sau →</a>
</div>
</body>
</html>