<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản lý luồng nhập/xuất</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald">
  <link rel="stylesheet" href="/style.main.min.b8048638da11b2704c9ac4157cecae3c80b86dacaa16790b14b3a9f17eade743.css">
</head>
<body>

<nav class="topnav">
  <ul>
    <li><a href="/index.html">Trang chủ</a></li>
    <li><a href="/java-installation.html">Giới thiệu & Cài đặt Java</a></li>
    <li><a href="/session2-foundation.html">Kiến thức nền tảng</a></li>
    <li><a href="/session3-io.html">Quản lý luồng nhập/xuất</a></li>
    <li><a href="/session4-network-address.html">Quản lý địa chỉ mạng</a></li>
    <li><a href="/session5-tcp.html">Lập trình Sockets TCP</a></li>
    <li><a href="/session6-udp.html">Lập trình Socket UDP</a></li>
    <li><a href="/session7-threading.html">Đa tuyến & Xử lý đồng thời</a></li>
    <li><a href="/session8-rmi.html">Multicast UDP & Java RMI</a></li>
    <li><a href="/appendix-courses.html">Khóa học bổ trợ</a></li>
  </ul>
</nav>
<style>
.topnav {
  background-color: #222;
  overflow: hidden;
  text-align: center;
  margin-bottom: 20px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.topnav ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
  display: inline-block;
}
.topnav li {
  display: inline;
}
.topnav a {
  display: inline-block;
  color: white;
  text-align: center;
  padding: 14px 20px;
  text-decoration: none;
  font-family: 'Roboto', sans-serif;
}
.topnav a:hover {
  background-color: #575757;
  color: #fff;
}
.topnav a.active {
  background-color: #0078d7;
  color: white;
  border-radius: 3px;
}
</style>
<!-- Code font-size control toolbar -->
<div id="code-size-toolbar" style="position:fixed;right:18px;bottom:18px;background:rgba(0,0,0,0.6);color:#fff;padding:8px;border-radius:8px;z-index:9999;display:flex;gap:6px;align-items:center;font-family:Arial,Helvetica,sans-serif;">
  <button id="code-decrease" title="Giảm cỡ chữ" style="background:transparent;border:1px solid rgba(255,255,255,0.2);color:#fff;padding:6px 8px;border-radius:4px;cursor:pointer;">A-</button>
  <button id="code-reset" title="Reset" style="background:transparent;border:1px solid rgba(255,255,255,0.2);color:#fff;padding:6px 8px;border-radius:4px;cursor:pointer;">A</button>
  <button id="code-increase" title="Tăng cỡ chữ" style="background:transparent;border:1px solid rgba(255,255,255,0.2);color:#fff;padding:6px 8px;border-radius:4px;cursor:pointer;">A+</button>
</div>

<script>
  (function(){
    const root = document.documentElement;
    const key = 'codeFontSizeRem';
    const min = 0.6, max = 2.4, step = 0.1;
    function getSize(){ return parseFloat(localStorage.getItem(key)) || 1.0; }
    function setSize(v){ v = Math.min(max, Math.max(min, Math.round(v*10)/10)); localStorage.setItem(key, v); root.style.setProperty('--code-font-size', v + 'rem'); }
    // init
    setSize(getSize());
    document.getElementById('code-decrease').addEventListener('click', ()=> setSize(getSize()-step));
    document.getElementById('code-increase').addEventListener('click', ()=> setSize(getSize()+step));
    document.getElementById('code-reset').addEventListener('click', ()=> setSize(1.0));
  })();
</script>
<style>
  :root{
    --max-width: 1000px;
    --bg: #ddd;
    --card: #ffffff;
    --muted: #666;
    --accent: #e3bfb8;
    --radius: 12px;
    --shadow: 0 10px 30px rgba(102,102,102,0.12);
    --base-font: 18px;
  }

  body{ background: var(--bg); font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; color:#0b1220; font-size:var(--base-font); line-height:1.6; }

  .lesson-content{ max-width:var(--max-width); margin:28px auto; padding:28px; background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); }

  .lesson-content h1{ font-family: 'Oswald', 'Segoe UI', sans-serif; font-size:3rem; margin-bottom:10px; color:var(--accent); }
  .lesson-content h2{ font-size:2rem; margin-top:22px; color:#0b2a44; }

  .lesson-content ul{ margin-left:1.05rem; }

  .topnav a{ padding:16px 22px; font-size:1rem; }

  .lesson-content img{ display:block; width:100%; border-radius:8px; border:1px solid rgba(11,18,32,0.04); box-shadow:0 4px 12px rgba(9,18,28,0.04); margin-bottom:18px; }

  :root{ --code-font-size: 1rem; }
  pre{ background:#0b1220; color:#e6eef8; padding:20px; border-radius:10px; overflow:auto; font-family: 'Courier New', monospace; font-size:calc(var(--code-font-size) * 1.1); box-shadow:0 8px 24px rgba(2,6,23,0.25); }
  code{ background:rgba(2,6,23,0.06); padding:4px 8px; border-radius:6px; font-family: 'Courier New', monospace; font-size:var(--code-font-size); }

  .callout{ background: rgba(227,191,184,0.08); border-left:4px solid var(--accent); padding:12px 16px; border-radius:8px; margin-bottom:18px; }
  .callout p{ margin:0; font-size:1.15rem; color:#0b1220; }

  @media (max-width:640px){
    :root{ --base-font:18px; }
    .topnav ul{ display:block; }
    .topnav li{ display:block; }
    .topnav a{ display:block; padding:12px; }
    .lesson-content{ margin:14px; padding:18px; border-radius:10px; }
    .lesson-content h1{ font-size:2.2rem; }
  }
</style>
<style>
  .lesson-content b, .lesson-content strong { font-family: 'Oswald','Segoe UI',sans-serif; font-weight:700; color:#0b2a44; }
</style>

<div class="lesson-content">
  <h1>Quản lý luồng nhập/xuất (I/O Streams)</h1>

  <h2>Mục tiêu bài học</h2>
  <ul>
    <li>Nhận biết các khái niệm cơ bản trong lập trình mạng: địa chỉ, cổng, socket, giao thức TCP/UDP, mô hình client–server</li>
    <li>Hiểu khái niệm luồng (Stream) và phân biệt Byte Stream vs Character Stream</li>
    <li>Áp dụng buffering, mã hóa ký tự (encoding) và try-with-resources khi làm việc với I/O</li>
    <li>Thực hành đọc/ghi file văn bản, sao chép file nhị phân và đọc/ghi dữ liệu qua socket</li>
  </ul>

  <h2>1. Mở đầu: Tổng quan ngắn về mạng</h2>
  <div class="callout"><p>Ứng dụng mạng trao đổi dữ liệu qua <b>địa chỉ IP</b> và <b>cổng (port)</b> bằng <b>giao thức</b> (TCP/UDP). Lập trình mạng trong Java làm việc với <b>Socket</b> (điểm cuối của kết nối).</p></div>
  <ul>
    <li><b>TCP</b>: hướng kết nối, tin cậy, có thứ tự — dùng cho trao đổi văn bản/nhị phân cần đảm bảo</li>
    <li><b>UDP</b>: không kết nối, nhanh nhưng có thể mất gói — phù hợp streaming/thông báo</li>
    <li><b>Client–Server</b>: Server lắng nghe trên port, client kết nối; sau khi kết nối, hai bên gửi/nhận bytes qua <i>streams</i></li>
  </ul>

  <h2>2. Kiến thức về luồng nhập/xuất (I/O)</h2>
  <p>Java cung cấp gói <code>java.io</code> và <code>java.nio</code>. Trong phạm vi cơ bản, ta dùng <code>java.io</code> với hai nhóm chính:</p>
  <ul>
    <li><b>Byte Streams</b>: <code>InputStream</code>/<code>OutputStream</code> — làm việc với dữ liệu nhị phân (ảnh, pdf, socket thô)</li>
    <li><b>Character Streams</b>: <code>Reader</code>/<code>Writer</code> — làm việc với văn bản có mã hóa (UTF-8, …)</li>
  </ul>
  <p><b>Buffering</b> (ví dụ <code>BufferedReader</code>/<code>BufferedInputStream</code>) giúp giảm số lần truy cập I/O, tăng hiệu năng. <b>Encoding</b> xác định cách ánh xạ byte ↔ ký tự, nên chỉ định <code>Charset</code> khi đọc/ghi văn bản. Dùng <b>try-with-resources</b> để tự động đóng tài nguyên:</p>
  <pre><code class="language-java">try (var r = new java.io.BufferedReader(new java.io.FileReader("in.txt"))) {
  // sử dụng r
} // tự đóng ở đây
</code></pre>

  <h2>3. Ví dụ 1 — Đọc/ghi văn bản (Character Stream)</h2>
  <img src="img/session3-example.png" alt="Code minh họa buổi 3" style="width:100%;border-radius:8px;margin-bottom:15px;">
  <pre><code class="language-java">import java.io.*;
import java.nio.charset.StandardCharsets;

public class TextCopy {
 public static void main(String[] args) throws IOException {
   try (BufferedReader br = new BufferedReader(
          new InputStreamReader(new FileInputStream("input.txt"), StandardCharsets.UTF_8));
        BufferedWriter bw = new BufferedWriter(
          new OutputStreamWriter(new FileOutputStream("output.txt"), StandardCharsets.UTF_8))) {
     String line;
     while ((line = br.readLine()) != null) {
       bw.write(line);
       bw.newLine();
     }
   }
   System.out.println("Sao chép văn bản (UTF-8) thành công!");
 }
}
  </code></pre>

  <h3>Kết quả khi chạy</h3>
  <pre><code>
Sao chép văn bản (UTF-8) thành công!
  </code></pre>
  <p>Ta bọc <code>FileInputStream</code>/<code>FileOutputStream</code> bởi <code>InputStreamReader</code>/<code>OutputStreamWriter</code> để xử lý <b>encoding</b>, và bọc tiếp bằng <code>BufferedReader</code>/<code>BufferedWriter</code> để tăng hiệu năng.</p>
  <h3>Giải thích chi tiết</h3>
  <ul>
    <li><code>FileInputStream</code>/<code>FileOutputStream</code>: lớp nền đọc/ghi byte từ/tới file</li>
    <li><code>InputStreamReader</code>/<code>OutputStreamWriter</code>: chuyển đổi byte ↔ ký tự theo <code>StandardCharsets.UTF_8</code></li>
    <li><code>BufferedReader</code>/<code>BufferedWriter</code>: giảm số lần I/O bằng bộ đệm; dùng <code>readLine()</code>/<code>newLine()</code> để thao tác theo dòng</li>
    <li><code>try</code>-with-resources: tự động đóng stream, kể cả khi có ngoại lệ</li>
    <li>Khi xử lý văn bản có dấu (tiếng Việt), cần chỉ định charset để tránh lỗi hiển thị</li>
  </ul>

  <h2>4. Ví dụ 2 — Sao chép nhị phân (Byte Stream)</h2>
  <pre><code class="language-java">import java.io.*;

public class BinaryCopy {
 public static void main(String[] args) throws IOException {
   byte[] buf = new byte[8192];
   int n;
   try (BufferedInputStream in = new BufferedInputStream(new FileInputStream("in.bin"));
        BufferedOutputStream out = new BufferedOutputStream(new FileOutputStream("out.bin"))) {
     while ((n = in.read(buf)) != -1) {
       out.write(buf, 0, n);
     }
   }
   System.out.println("Sao chép nhị phân thành công!");
 }
}
  </code></pre>

  <h3>Kết quả khi chạy</h3>
  <pre><code>
Sao chép nhị phân thành công!
  </code></pre>
  <p>Dùng mảng đệm byte lớn (8KB) giúp sao chép nhanh hơn so với đọc/ghi từng byte.</p>
  <h3>Giải thích chi tiết</h3>
  <ul>
    <li>Dùng mảng đệm 8KB, lặp đọc đến khi <code>read()</code> trả về <code>-1</code></li>
    <li><code>BufferedInputStream/BufferedOutputStream</code> giúp giảm overhead hệ thống</li>
    <li>Đóng stream sẽ flush dữ liệu còn lại trong bộ đệm ra đĩa</li>
    <li>Có thể dùng <code>Files.copy(Path.of("in.bin"), Path.of("out.bin"))</code> như một lựa chọn ngắn gọn (Java NIO)</li>
  </ul>

  <h2>5. Ví dụ 3 — Đọc/ghi qua mạng (Socket + Streams)</h2>
  <pre><code class="language-java">import java.io.*;
import java.net.*;
import java.nio.charset.StandardCharsets;

public class SocketEchoClient {
 public static void main(String[] args) throws IOException {
   try (Socket socket = new Socket("localhost", 5000);
        BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream(), StandardCharsets.UTF_8));
        PrintWriter out = new PrintWriter(new OutputStreamWriter(socket.getOutputStream(), StandardCharsets.UTF_8), true)) {
     out.println("Hello Server");     // ghi văn bản qua OutputStream của socket
     String resp = in.readLine();     // đọc phản hồi
     System.out.println("Server trả lời: " + resp);
   }
 }
}
  </code></pre>

  <h3>Kết quả khi chạy (giả sử server đang chạy)</h3>
  <pre><code>
Server trả lời: Hello Server
  </code></pre>
  <p>Khi kết nối TCP được thiết lập, bạn <b>đọc</b> từ <code>socket.getInputStream()</code> và <b>ghi</b> vào <code>socket.getOutputStream()</code>. Các stream này tương tự stream file về cách sử dụng.</p>
  <h3>Giải thích chi tiết</h3>
  <ul>
    <li><code>new Socket("localhost", 5000)</code> tạo kết nối TCP tới server đang lắng nghe cổng 5000</li>
    <li><code>getInputStream()</code>/<code>getOutputStream()</code> cung cấp streams để đọc/ghi dữ liệu</li>
    <li><code>PrintWriter(..., true)</code> bật <code>autoFlush</code> giúp <code>println()</code> tự flush khi xuống dòng</li>
    <li>Giao thức ví dụ: trao đổi chuỗi theo dòng; phía server cần đọc và echo lại để client <code>readLine()</code> không bị treo</li>
    <li>Nếu không có server chạy, việc tạo socket sẽ báo lỗi kết nối (Connection refused)</li>
  </ul>

  <h2>6. Lưu ý và lỗi thường gặp</h2>
  <ul>
    <li>Thiếu <b>flush()</b> khi dùng <code>Writer</code>/<code>OutputStream</code> có buffer (hoặc bật <code>autoFlush=true</code> cho PrintWriter)</li>
    <li>Quên chỉ định <b>Charset</b> khiến tiếng Việt hiển thị sai</li>
    <li>Không đóng tài nguyên gây rò rỉ handle; nên dùng <b>try-with-resources</b></li>
    <li>Đọc/ghi từng byte gây chậm — nên dùng buffer</li>
  </ul>

  <h2>Tổng kết</h2>
  <p>Luồng nhập/xuất là nền tảng để làm việc với file và mạng. Hãy lựa chọn đúng loại stream (byte/char), sử dụng buffer và charset phù hợp, 
  đồng thời quản lý tài nguyên an toàn bằng try-with-resources để đạt hiệu năng và độ tin cậy cao.</p>
</div>

<style>
  .pager{ max-width:var(--max-width); margin:10px auto 40px; padding:0 28px; display:flex; justify-content:space-between; align-items:center; }
  .pager a{ display:inline-block; background:#0078d7; color:#fff; padding:12px 18px; border-radius:8px; text-decoration:none; font-weight:600; box-shadow:0 4px 10px rgba(0,0,0,0.08); transition:background .2s ease, transform .1s ease; }
  .pager a:hover{ background:#005a9e; transform:translateY(-1px); }
  .pager a.disabled{ background:#b9c5d1; pointer-events:none; cursor:default; }
</style>
<div class="pager">
  <a class="prev" href="/session2-foundation.html">← Trang trước</a>
  <a class="next" href="/session4-network-address.html">Trang sau →</a>
</div>
</body>
</html>
