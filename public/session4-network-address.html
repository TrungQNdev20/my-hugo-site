<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản lý địa chỉ mạng</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald">
  <link rel="stylesheet" href="/style.main.min.b8048638da11b2704c9ac4157cecae3c80b86dacaa16790b14b3a9f17eade743.css">
</head>
<body>
<nav class="topnav">
  <ul>
    <li><a href="/index.html">Trang chủ</a></li>
    <li><a href="/java-installation.html">Giới thiệu & Cài đặt Java</a></li>
    <li><a href="/session2-foundation.html">Kiến thức nền tảng</a></li>
    <li><a href="/session3-io.html">Quản lý luồng nhập/xuất</a></li>
    <li><a href="/session4-network-address.html">Quản lý địa chỉ mạng</a></li>
    <li><a href="/session5-tcp.html">Lập trình Sockets TCP</a></li>
    <li><a href="/session6-udp.html">Lập trình Socket UDP</a></li>
    <li><a href="/session7-threading.html">Đa tuyến & Xử lý đồng thời</a></li>
    <li><a href="/session8-rmi.html">Multicast UDP & Java RMI</a></li>
    <li><a href="/appendix-courses.html">Khóa học bổ trợ</a></li>
  </ul>
</nav>
<style>
.topnav {
  background-color: #222;
  overflow: hidden;
  text-align: center;
  margin-bottom: 20px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
.topnav ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
  display: inline-block;
}
.topnav li {
  display: inline;
}
.topnav a {
  display: inline-block;
  color: white;
  text-align: center;
  padding: 14px 20px;
  text-decoration: none;
  font-family: 'Roboto', sans-serif;
}
.topnav a:hover {
  background-color: #575757;
  color: #fff;
}
.topnav a.active {
  background-color: #0078d7;
  color: white;
  border-radius: 3px;
}
</style>
<!-- Code font-size control toolbar -->
<div id="code-size-toolbar" style="position:fixed;right:18px;bottom:18px;background:rgba(0,0,0,0.6);color:#fff;padding:8px;border-radius:8px;z-index:9999;display:flex;gap:6px;align-items:center;font-family:Arial,Helvetica,sans-serif;">
  <button id="code-decrease" title="Giảm cỡ chữ" style="background:transparent;border:1px solid rgba(255,255,255,0.2);color:#fff;padding:6px 8px;border-radius:4px;cursor:pointer;">A-</button>
  <button id="code-reset" title="Reset" style="background:transparent;border:1px solid rgba(255,255,255,0.2);color:#fff;padding:6px 8px;border-radius:4px;cursor:pointer;">A</button>
  <button id="code-increase" title="Tăng cỡ chữ" style="background:transparent;border:1px solid rgba(255,255,255,0.2);color:#fff;padding:6px 8px;border-radius:4px;cursor:pointer;">A+</button>
</div>

<script>
  (function(){
    const root = document.documentElement;
    const key = 'codeFontSizeRem';
    const min = 0.6, max = 2.4, step = 0.1;
    function getSize(){ return parseFloat(localStorage.getItem(key)) || 1.0; }
    function setSize(v){ v = Math.min(max, Math.max(min, Math.round(v*10)/10)); localStorage.setItem(key, v); root.style.setProperty('--code-font-size', v + 'rem'); }
    // init
    setSize(getSize());
    document.getElementById('code-decrease').addEventListener('click', ()=> setSize(getSize()-step));
    document.getElementById('code-increase').addEventListener('click', ()=> setSize(getSize()+step));
    document.getElementById('code-reset').addEventListener('click', ()=> setSize(1.0));
  })();
</script>
<style>
  :root{
    --max-width: 1000px;
    --bg: #ddd;
    --card: #ffffff;
    --muted: #666;
    --accent: #e3bfb8;
    --radius: 12px;
    --shadow: 0 10px 30px rgba(102,102,102,0.12);
    --base-font: 18px;
  }

  body{ background: var(--bg); font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; color:#0b1220; font-size:var(--base-font); line-height:1.6; }

  .lesson-content{ max-width:var(--max-width); margin:28px auto; padding:28px; background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); }

  .lesson-content h1{ font-family: 'Oswald', 'Segoe UI', sans-serif; font-size:3rem; margin-bottom:10px; color:var(--accent); }
  .lesson-content h2{ font-size:2rem; margin-top:22px; color:#0b2a44; }

  .lesson-content ul{ margin-left:1.05rem; }

  .topnav a{ padding:16px 22px; font-size:1rem; }

  .lesson-content img{ display:block; width:100%; border-radius:8px; border:1px solid rgba(11,18,32,0.04); box-shadow:0 4px 12px rgba(9,18,28,0.04); margin-bottom:18px; }

  :root{ --code-font-size: 1rem; }
  pre{ background:#0b1220; color:#e6eef8; padding:20px; border-radius:10px; overflow:auto; font-family: 'Courier New', monospace; font-size:calc(var(--code-font-size) * 1.1); box-shadow:0 8px 24px rgba(2,6,23,0.25); }
  code{ background:rgba(2,6,23,0.06); padding:4px 8px; border-radius:6px; font-family: 'Courier New', monospace; font-size:var(--code-font-size); }

  .callout{ background: rgba(227,191,184,0.08); border-left:4px solid var(--accent); padding:12px 16px; border-radius:8px; margin-bottom:18px; }
  .callout p{ margin:0; font-size:1.15rem; color:#0b1220; }

  @media (max-width:640px){
    :root{ --base-font:18px; }
    .topnav ul{ display:block; }
    .topnav li{ display:block; }
    .topnav a{ display:block; padding:12px; }
    .lesson-content{ margin:14px; padding:18px; border-radius:10px; }
    .lesson-content h1{ font-size:2.2rem; }
  }
</style>
<style>
  .lesson-content b, .lesson-content strong { font-family: 'Oswald','Segoe UI',sans-serif; font-weight:700; color:#0b2a44; }
</style>
<div class="lesson-content">
  <h1>Quản lý địa chỉ mạng (InetAddress, NetworkInterface)</h1>

  <h2>Mục tiêu bài học</h2>
  <ul>
    <li>Ôn tập địa chỉ IP (IPv4/IPv6), hostname, DNS; loopback, private, link-local</li>
    <li>Hiểu subnet mask/CIDR, quan hệ interface ↔ địa chỉ, máy đa card mạng</li>
    <li>Nắm API <code>InetAddress</code> để tra cứu IP/hostname và kiểm tra reachability</li>
    <li>Thao tác <code>NetworkInterface</code> để liệt kê card mạng, địa chỉ, cờ trạng thái và MAC</li>
    <li>Thực hành: tra cứu DNS, liệt kê interface chi tiết, kiểm tra reachability bằng ICMP/TCP</li>
  </ul>

  <h2>1. Lý thuyết bổ sung</h2>
  <ul>
    <li><b>IPv4</b>: bốn octet thập phân, ví dụ 192.168.1.10; <b>IPv6</b>: địa chỉ 128-bit dạng hex (ví dụ <code>fe80::1</code>).</li>
    <li><b>Loopback</b>: 127.0.0.1 (IPv4), ::1 (IPv6) — trỏ về chính máy.</li>
    <li><b>Private</b>: 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16; <b>Link‑local</b>: 169.254.0.0/16 (IPv4), <code>fe80::/10</code> (IPv6).</li>
    <li><b>Subnet/CIDR</b>: 192.168.1.0/24 nghĩa là 24 bit mạng, 8 bit host.</li>
    <li><b>Hostname & DNS</b>: tên máy (host) được phân giải sang IP qua DNS; cũng có reverse lookup IP → tên.</li>
    <li><b>Interface</b>: card mạng (vật lý/ảo). Một interface có thể có nhiều địa chỉ (IPv4/IPv6).</li>
  </ul>

  <h2>2. <code>InetAddress</code> — các phương thức thường dùng</h2>
  <ul>
    <li><code>getLocalHost()</code>, <code>getByName(host)</code>, <code>getAllByName(host)</code></li>
    <li><code>getHostName()</code>, <code>getHostAddress()</code>, <code>getCanonicalHostName()</code> (thử reverse DNS)</li>
    <li><code>isReachable(timeout)</code>: ping ICMP hoặc TCP tuỳ nền tảng — chỉ mang tính tham khảo</li>
  </ul>

  <h2>3. Ví dụ 1 — Tra cứu DNS (forward + reverse)</h2>
  <pre><code class="language-java">import java.net.*;

public class DnsLookup {
  public static void main(String[] args) throws Exception {
    String host = args.length &gt; 0 ? args[0] : "example.com";
    InetAddress[] addrs = InetAddress.getAllByName(host);
    System.out.println("Host: " + host);
    for (InetAddress a : addrs) {
      System.out.println(" - IP: " + a.getHostAddress() +
        " | Reverse: " + a.getCanonicalHostName());
    }
  }
}
</code></pre>

<h3>Kết quả khi chạy (ví dụ với example.com)</h3>
<pre><code>
Host: example.com
- IP: 93.184.216.34 | Reverse: 93.184.216.34
</code></pre>

<h3>Giải thích chi tiết</h3>
<ul>
  <li><code>getAllByName</code> trả về tất cả địa chỉ (A/AAAA) của host.</li>
  <li><code>getCanonicalHostName()</code> thử reverse DNS (có thể trả về chính IP nếu không có bản ghi PTR).</li>
  <li>Truyền đối số dòng lệnh để kiểm tra tên miền/host khác nhau.</li>
</ul>

  <h2>4. Ví dụ 2 — Liệt kê Interface, địa chỉ, MAC, cờ trạng thái</h2>
  <pre><code class="language-java">import java.net.*;
import java.util.*;

public class IfaceList {
  public static void main(String[] args) throws Exception {
    Enumeration nets = NetworkInterface.getNetworkInterfaces();
    while (nets.hasMoreElements()) {
      NetworkInterface ni = (NetworkInterface) nets.nextElement();
      System.out.println("\nInterface: " + ni.getName() + " - " + ni.getDisplayName());
      System.out.println("  Up:" + ni.isUp() + ", Loopback:" + ni.isLoopback() +
                         ", Virtual:" + ni.isVirtual() + ", Multicast:" + ni.supportsMulticast());
      byte[] mac = ni.getHardwareAddress();
      if (mac != null) {
        StringBuilder sb = new StringBuilder();
        for (byte b : mac) sb.append(String.format("%02X:", b));
        System.out.println("  MAC: " + sb.substring(0, sb.length()-1));
      }
      for (InterfaceAddress ia : ni.getInterfaceAddresses()) {
        String ip = ia.getAddress().getHostAddress();
        short prefix = ia.getNetworkPrefixLength();
        System.out.println("  Addr: " + ip + "/" + prefix);
      }
    }
  }
}
</code></pre>
  <h3>Giải thích chi tiết</h3>
  <ul>
    <li><code>isUp/isLoopback/isVirtual/supportsMulticast</code> cho biết trạng thái và khả năng của card.</li>
    <li><code>getHardwareAddress()</code> trả về MAC dưới dạng mảng byte cần định dạng lại.</li>
    <li><code>getInterfaceAddresses()</code> cung cấp địa chỉ + độ dài tiền tố (CIDR).</li>
    <li>Một interface có thể có nhiều địa chỉ (IPv4/IPv6) — in hết để kiểm tra cấu hình.</li>
  </ul>

  <h2>5. Ví dụ 3 — Kiểm tra reachability: ICMP/TCP</h2>
  <pre><code class="language-java">import java.net.*;
import java.io.*;

public class ReachabilityCheck {
  public static void main(String[] args) throws Exception {
    String host = args.length &gt; 0 ? args[0] : "8.8.8.8";
    int timeout = 2000;
    InetAddress target = InetAddress.getByName(host);
    System.out.println("Ping (isReachable," + timeout + "ms): " + target.isReachable(timeout));

    try (Socket s = new Socket()) {
      s.connect(new InetSocketAddress(target, 80), timeout);
      System.out.println("TCP connect 80: SUCCESS");
    } catch (IOException e) {
      System.out.println("TCP connect 80: FAIL (" + e.getClass().getSimpleName() + ")");
    }
  }
}
</code></pre>
  <h3>Giải thích chi tiết</h3>
  <ul>
    <li><code>isReachable()</code> phụ thuộc nền tảng/quyền ICMP; đôi khi dùng TCP connect đáng tin cậy hơn cho dịch vụ cụ thể.</li>
    <li>Thử nhiều cổng (80/443/22…) để kiểm tra dịch vụ đang mở.</li>
    <li><code>connect</code> có timeout giúp tránh treo lâu khi host không phản hồi.</li>
  </ul>

  <h2>6. Lưu ý thường gặp</h2>
  <ul>
    <li>Máy đa card mạng có nhiều địa chỉ IP; <code>getLocalHost()</code> không luôn là địa chỉ mong muốn.</li>
    <li>Reverse DNS có thể không cấu hình → <code>getCanonicalHostName()</code> trả về chính IP.</li>
    <li>Quyền ICMP có thể bị chặn; ưu tiên kiểm tra TCP nếu mục tiêu là dịch vụ ứng dụng.</li>
  </ul>

  <h2>Tổng kết</h2>
  <p>Bạn đã nắm khái niệm địa chỉ/host, phân giải DNS, và cách khai thác <code>InetAddress</code>/<code>NetworkInterface</code> để kiểm tra cấu hình mạng. 
  Các ví dụ minh hoạ giúp bạn tra cứu DNS, liệt kê card mạng và đánh giá khả dụng kết nối trên thực tế.</p>
</div>

<style>
  .pager{ max-width:var(--max-width); margin:10px auto 40px; padding:0 28px; display:flex; justify-content:space-between; align-items:center; }
  .pager a{ display:inline-block; background:#0078d7; color:#fff; padding:12px 18px; border-radius:8px; text-decoration:none; font-weight:600; box-shadow:0 4px 10px rgba(0,0,0,0.08); transition:background .2s ease, transform .1s ease; }
  .pager a:hover{ background:#005a9e; transform:translateY(-1px); }
  .pager a.disabled{ background:#b9c5d1; pointer-events:none; cursor:default; }
</style>
<div class="pager">
  <a class="prev" href="/session3-io.html">← Trang trước</a>
  <a class="next" href="/session5-tcp.html">Trang sau →</a>
</div>
</body>
</html>
